import{E as e,aH as u,ae as w,b3 as T,q as f,S as C,af as W,am as D,aB as E,a3 as N,ag as P,dg as o,dd as B,k as M,bd as y,bv as h,L as m,bf as X,by as b,x as O,cC as q,cD as z,dh as A,C as _,P as J,cv as K,bJ as Q,bL as j,bM as Y,bN as Z,bO as p,bP as ee,bQ as te,U as k,bR as re,bS as ne,bT as ae,bU as se,a6 as le,a7 as L,d1 as oe,db as ge,dc as ce,de as g,df as ie}from"./index-BIQ2twld.js";import{f as de}from"./index-DvL4J3FT.js";import{D as ue}from"./DeletePopover-BV0Kd4pp.js";const I=t=>{let r=t.total_space,a=r-t.free_space;const c=["B","K","M","G","T","P","E"],s=1024;let l=0;for(;l<c.length-1&&(a>=s||r>=s);)a/=s,r/=s,l++;return"".concat(a.toFixed(2)," / ").concat(r.toFixed(2)," ").concat(c[l])},he=t=>(t.total_space-t.free_space)/t.total_space*100,F=t=>t.free_space/t.total_space<.1;function R(t){const r=f(),{to:a}=M(),[c,s]=y(()=>h.post("/admin/storage/delete?id=".concat(t.storage.id))),[l,i]=y(()=>h.post("/admin/storage/".concat(t.storage.disabled?"enable":"disable","?id=").concat(t.storage.id)));return[e(m,{onClick:()=>{a("/@manage/storages/edit/".concat(t.storage.id))},get children(){return r("global.edit")}}),e(m,{get loading(){return l()},get colorScheme(){return t.storage.disabled?"success":"warning"},onClick:async()=>{const d=await i();X(d,()=>{t.refresh()})},get children(){return r("global.".concat(t.storage.disabled?"enable":"disable"))}}),e(ue,{get name(){return t.storage.mount_path},get loading(){return c()},onClick:async()=>{const d=await s();b(d,()=>{O.success(r("global.delete_success")),t.refresh()})}})]}function me(t){return e(C,{get when(){return t.details},get children(){return e(q,{class:"disk-usage-percentage",trackColor:"$info3",rounded:"$full",size:"md",get value(){return he(t.details)},get children(){return[e(z,{get color(){return F(t.details)?"$danger6":"$info6"},rounded:"$md"}),e(A,{class:"disk-usage-text",get children(){return I(t.details)}})]}})}})}function be(t){const r=f();return e(P,{w:"$full",spacing:"$2",rounded:"$lg",border:"1px solid $neutral7",get background(){return N("$neutral2","$neutral3")()},p:"$3",get _hover(){return{border:"1px solid ".concat(E())}},get children(){return[e(u,{spacing:"$2",get children(){return[e(w,{fontWeight:"$medium",css:{wordBreak:"break-all"},get children(){return t.storage.mount_path}}),e(T,{colorScheme:"info",get children(){return r("drivers.drivers.".concat(t.storage.driver))}}),e(C,{get when(){return t.storage.mount_details},get children(){return e(T,{get colorScheme(){return F(t.storage.mount_details)?"danger":"success"},get children(){return I(t.storage.mount_details)}})}})]}}),e(u,{get children(){return[e(w,{get children(){return[W(()=>r("storages.common.status")),":Â "]}}),e(D,{css:{wordBreak:"break-all"},overflowX:"auto",get innerHTML(){return r("storages.table_fields.status.".concat(t.storage.status),void 0,t.storage.status)}})]}}),e(w,{css:{wordBreak:"break-all"},get children(){return t.storage.remark}}),e(u,{spacing:"$2",get children(){return e(R,t)}})]}})}function fe(t){const r=f();return e(B,{get children(){return[e(o,{get children(){return t.storage.mount_path}}),e(o,{get children(){return r("drivers.drivers.".concat(t.storage.driver))}}),e(o,{get children(){return t.storage.order}}),e(o,{get children(){return e(me,{get details(){return t.storage.mount_details}})}}),e(o,{get children(){return r("storages.table_fields.status.".concat(t.storage.status),void 0,t.storage.status)}}),e(o,{get children(){return t.storage.remark}}),e(o,{get children(){return e(u,{spacing:"$2",get children(){return e(R,t)}})}})]}})}const _e=()=>{const t=f();de("manage.sidemenu.storages");const{to:r}=M(),[a,c]=y(()=>h.get("/admin/storage/list")),[s,l]=_([]),i=async()=>{const n=await c();b(n,v=>l(v.content))},[d,H]=_([]),[S,U]=_([]);(async()=>{const n=await h.get("/admin/driver/names");b(n,v=>H(v))})(),i();const G=async()=>{const n=await h.post("/admin/storage/load_all");b(n,()=>{O.success(t("storages.other.start_load_success"))})},x=J(()=>s().filter(n=>S().length===0?!0:S().includes(n.driver))),[$,V]=K("storages-layout","grid");return e(P,{spacing:"$3",alignItems:"start",w:"$full",get children(){return[e(u,{spacing:"$2",w:"$full",wrap:"nowrap",get children(){return[e(m,{colorScheme:"accent",get loading(){return a()},onClick:i,get children(){return t("global.refresh")}}),e(m,{onClick:()=>{r("/@manage/storages/add")},get children(){return t("global.add")}}),e(m,{colorScheme:"warning",get loading(){return a()},onClick:G,get children(){return t("storages.other.load_all")}}),e(C,{get when(){return d().length>0},get children(){return e(Q,{multiple:!0,get value(){return S()},onChange:U,get children(){return[e(j,{get children(){return[e(Y,{get children(){return t("storages.other.filter_by_driver")}}),e(Z,{}),e(p,{})]}}),e(ee,{get children(){return e(te,{get children(){return e(k,{get each(){return d()},children:n=>e(re,{value:n,get children(){return[e(ne,{get children(){return t("drivers.drivers.".concat(n))}}),e(ae,{})]}})})}})}})]}})}}),e(se,{flexShrink:0,get checked(){return $()==="table"},onChange:n=>{V(n.currentTarget.checked?"table":"grid")},get children(){return t("storages.other.table_layout")}})]}}),e(le,{get children(){return[e(L,{get when(){return $()==="grid"},get children(){return e(oe,{w:"$full",gap:"$2_5",templateColumns:{"@initial":"1fr","@lg":"repeat(auto-fill, minmax(324px, 1fr))"},get children(){return e(k,{get each(){return x()},children:n=>e(be,{storage:n,refresh:i})})}})}}),e(L,{get when(){return $()==="table"},get children(){return e(D,{w:"$full",overflowX:"auto",get children(){return e(ge,{highlightOnHover:!0,dense:!0,css:{tableLayout:"auto",width:"100%"},get children(){return[e(ce,{get children(){return e(B,{get children(){return[e(g,{get children(){return t("storages.common.mount_path")}}),e(g,{get children(){return t("storages.common.driver")}}),e(g,{get children(){return t("storages.common.order")}}),e(g,{css:{minWidth:"100px"},get children(){return t("storages.common.usage")}}),e(g,{get children(){return t("storages.common.status")}}),e(g,{get children(){return t("storages.common.remark")}}),e(g,{get children(){return t("global.operations")}})]}})}}),e(ie,{get children(){return e(k,{get each(){return x()},children:n=>e(fe,{storage:n,refresh:i})})}})]}})}})}})]}})]}})};export{_e as default};
