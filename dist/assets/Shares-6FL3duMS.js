import{bY as v,E as r,dg as i,S as f,aK as b,aL as o,af as _,q as $,aH as k,L as c,b$ as L,dd as y,b3 as O,W as x,k as T,bd as w,bv as S,bf as W,by as C,x as U,C as B,aZ as H,aY as I,am as R,db as F,dc as M,U as m,de as u,df as P,ag as Y}from"./index-KgNcVsnB.js";import{f as q}from"./index-tIPZKPfd.js";import{m as A}from"./share-BYkyraE_.js";import{D as E}from"./DeletePopover--8foV9kW.js";function K(e){const t=$(),{to:l}=T(),[h,d]=w(()=>S.post("/share/delete?id=".concat(e.share.id))),[g,a]=w(()=>S.post("/share/".concat(e.share.disabled?"enable":"disable","?id=").concat(e.share.id)));return[r(c,{get disabled(){return!e.canShare},onClick:()=>{l("/@manage/shares/edit/".concat(e.share.id))},get children(){return t("global.edit")}}),r(c,{get loading(){return g()},get colorScheme(){return e.share.disabled?"success":"warning"},onClick:async()=>{const s=await a();W(s,()=>{e.refresh()})},get children(){return t("global.".concat(e.share.disabled?"enable":"disable"))}}),r(E,{get name(){return e.share.id},get loading(){return h()},onClick:async()=>{const s=await d();C(s,()=>{U.success(t("global.delete_success")),e.refresh()})}})]}const N=e=>{if(e.role<0)return null;const t=["info","neutral","accent"];return r(O,{get colorScheme(){return t[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})};function V(e){const t=$(),l=()=>{if(e.share.files.length===0)return"";let a=e.share.files[0];return e.share.files.length>1&&(a+=t("shares.files_etc",{more:e.share.files.length-1})),a},h=()=>e.share.max_accessed>0?"".concat(e.share.accessed," / ").concat(e.share.max_accessed):"".concat(e.share.accessed),d=()=>e.share.disabled?"disabled":e.share.max_accessed>0&&e.share.accessed>=e.share.max_accessed||e.share.files.length===0||e.share.expires&&new Date(e.share.expires)<new Date?"invalid":e.share.creator===o().username&&!e.canShare?"denied":"work",{copy:g}=v();return r(y,{get children(){return[r(i,{get children(){return l()}}),r(i,{get children(){return e.share.id}}),r(f,{get when(){return b.is_admin(o())},get children(){return r(i,{get children(){return r(N,{get name(){return e.share.creator},get role(){return e.share.creator_role}})}})}}),r(i,{get children(){return _(()=>!!e.share.expires)()?new Date(e.share.expires).toLocaleString():""}}),r(i,{get children(){return h()}}),r(i,{get children(){return t("shares.status_list.".concat(d()))}}),r(i,{get children(){return e.share.remark}}),r(i,{get children(){return r(k,{spacing:"$2",get children(){return[r(c,{colorScheme:"primary",onClick:()=>{const a=A(e.share,{site_title:x("site_title")}),s=L(x("share_summary_content"),a);g(s)},get children(){return t("shares.copy_msg")}}),r(K,e)]}})}})]}})}const G=()=>{const e=$();q("manage.sidemenu.shares");const{to:t}=T(),[l,h]=w(()=>S.get("/share/list")),[d,g]=B([]),a=async()=>{const n=await h();C(n,D=>g(D.content))},s=b.can(o(),H.findIndex(n=>n==="share"));return a(),r(Y,{spacing:"$3",alignItems:"start",w:"$full",get children(){return[r(k,{spacing:"$2",gap:"$2",w:"$full",wrap:{"@initial":"wrap","@md":"unset"},get children(){return[r(c,{colorScheme:"accent",get loading(){return l()},onClick:a,get children(){return e("global.refresh")}}),r(f,{when:!s,get fallback(){return r(c,{onClick:()=>t("/@manage/shares/add"),get children(){return e("global.add")}})},get children(){return r(I,{withArrow:!0,get label(){return e("shares.no_permission_tip")},placement:"right",get children(){return r(c,{disabled:!0,get children(){return[" ",_(()=>e("global.add"))," "]}})}})}})]}}),r(R,{w:"$full",overflowX:"auto",get children(){return r(F,{highlightOnHover:!0,dense:!0,get children(){return[r(M,{get children(){return r(y,{get children(){return[r(m,{each:["files","id"],children:n=>r(u,{css:{minWidth:"90px"},get children(){return e("shares.".concat(n))}})}),r(f,{get when(){return b.is_admin(o())},get children(){return r(u,{css:{minWidth:"100px"},get children(){return e("shares.creator")}})}}),r(m,{each:["expires","accessed","status","remark"],children:n=>r(u,{css:{minWidth:"90px"},get children(){return e("shares.".concat(n))}})}),r(u,{get children(){return e("global.operations")}})]}})}}),r(P,{get children(){return r(m,{get each(){return d()},children:n=>r(V,{share:n,refresh:a,canShare:s})})}})]}})}})]}})};export{G as default};
