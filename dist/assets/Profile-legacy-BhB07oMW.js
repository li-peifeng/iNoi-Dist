System.register(["./index-legacy-yN-z1lAK.js","./index-legacy-DRrLOnvb.js","./index-legacy-WW2-yCg0.js","./webauthn-json.browser-ponyfill-legacy-8XJfKV2b.js","./PublicKeys-legacy-BpF13vS-.js"],function(e,r){"use strict";var n,t,s,i,a,c,o,u,l,g,d,h,p,w,_,m,f,b,$,y,v,I,k,x,C,S,j,U,E,L,P,T,J,D,O,R,V,X,q,B,F;return{setters:[e=>{n=e.bd,t=e.bv,s=e.C,i=e.E,a=e.cy,c=e.ai,o=e.c4,u=e.L,l=e.q,g=e.by,d=e.x,h=e.S,p=e.k,w=e.a7,_=e.cS,m=e.O,f=e.a6,b=e.ar,$=e.cT,y=e.bV,v=e.bI,I=e.I,k=e.J,x=e.aJ,C=e.cU,S=e.cV,j=e.cW,U=e.cX,E=e.ah,L=e.ac,P=e.ap,T=e.U,J=e.aZ,D=e.cw,O=e.b3},e=>{R=e.f},e=>{V=e.L},e=>{X=e.s,q=e.c,B=e.b},e=>{F=e.P}],execute:function(){const r=e=>{const r=l(),[p,w]=n(()=>t.post("/authn/delete_authn",{id:e.id})),[_,m]=s(!1);return i(h,{get when(){return!_()},get children(){return i(a,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[i(c,{w:"$full",alignItems:"start",spacing:"$1",get children(){return i(o,{color:"$info9",css:{wordBreak:"break-all"},get children(){return"Fingerprint: "+e.fingerprint+"\tID: "+e.id}})}}),i(a,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return i(u,{colorScheme:"danger",get loading(){return p()},onClick:async()=>{const e=await w();g(e,()=>{d.success(r("global.delete_success")),m(!0)})},get children(){return r("global.delete")}})}})]}})}})},K=e=>i(O,{get colorScheme(){return e.can?"success":"danger"},get children(){return e.children}});e("default",()=>{const e=l();R("manage.sidemenu.profile");const{searchParams:a,to:O}=p(),[M,N]=s(w().username),[W,Z]=s(""),[z,A]=s(""),G=b("sso_compatibility_mode"),[H,Q]=n(e=>t.post("/me/update",{username:e?w().username:M(),password:e?"":W(),sso_id:w().sso_id})),[Y,ee]=n(()=>t.get("/authn/getcredentials")),[,re]=n(()=>t.get("/authn/webauthn_begin_registration")),[ne,te]=n((e,r)=>t.post("/authn/webauthn_finish_registration",JSON.stringify(r),{headers:{session:e}})),se=async r=>{if(W()&&W()!==z())return void d.warning(e("users.confirm_password_not_same"));const n=await Q(r);g(n,()=>{_({...w(),username:M()}),r?O(""):(d.success(e("users.update_profile_success")),O(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})},ie=a.sso_id;function ae(e){const r=e.data;r.sso_id&&(_({...w(),sso_id:r.sso_id}),se(!0))}ie&&(_({...w(),sso_id:ie}),se(!0)),window.addEventListener("message",ae),m(()=>{window.removeEventListener("message",ae)});const[ce,oe]=s([]);return X()&&!f.is_guest(w())&&b("webauthn_login_enabled")&&(async()=>{const e=await ee();D(e,oe)})(),i(c,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[i(h,{get when(){return!f.is_guest(w())},get fallback(){return[i(C,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[i(S,{mr:"$2_5"}),i(j,{mr:"$2_5",get children(){return e("users.guest-tips")}}),i(U,{get children(){return e("users.modify_nothing")}})]}}),i(x,{spacing:"$2",get children(){return[i(E,{get children(){return e("global.have_account")}}),i(E,{color:"$info9",as:V,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return e("global.go_login")}})]}})]},get children(){return[i(o,{get children(){return e("users.update_profile")}}),i($,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return i(y,{get children(){return[i(v,{for:"username",get children(){return e("users.change_username")}}),i(I,{id:"username",get value(){return M()},onInput:e=>{N(e.currentTarget.value)}})]}})}}),i($,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[i(y,{get children(){return[i(v,{for:"password",get children(){return e("users.change_password")}}),i(I,{id:"password",type:"password",placeholder:"********",get value(){return W()},onInput:e=>{Z(e.currentTarget.value)}}),i(k,{get children(){return e("users.change_password-tips")}})]}}),i(y,{get children(){return[i(v,{for:"confirm-password",get children(){return e("users.confirm_password")}}),i(I,{id:"confirm-password",type:"password",placeholder:"********",get value(){return z()},onInput:e=>{A(e.currentTarget.value)}}),i(k,{get children(){return e("users.confirm_password-tips")}})]}})]}}),i(x,{spacing:"$2",get children(){return[i(u,{get loading(){return H()},onClick:[se,!1],get children(){return e("global.save")}}),i(h,{get when(){return!w().otp},get children(){return i(u,{colorScheme:"accent",onClick:()=>{O("/@manage/2fa")},get children(){return e("users.enable_2fa")}})}})]}})]}}),i(h,{get when(){return L(()=>!!b("sso_login_enabled"))()&&!f.is_guest(w())},get children(){return[i(o,{get children(){return e("users.sso_login")}}),i(x,{spacing:"$2",get children(){return i(h,{get when(){return w().sso_id},get fallback(){return i(u,{onClick:()=>{const e=t.getUri()+"/auth/sso?method=get_sso_id";G?window.location.href=e:window.open(e,"authPopup","width=500,height=600")},get children(){return e("users.connect_sso")}})},get children(){return i(u,{colorScheme:"danger",get loading(){return H()},onClick:()=>{_({...w(),sso_id:""}),se(!0)},get children(){return e("users.disconnect_sso")}})}})}})]}}),i(h,{get when(){return L(()=>!f.is_guest(w()))()&&b("webauthn_login_enabled")},get children(){return[i(o,{get children(){return e("users.webauthn")}}),i(x,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return i(P,{get loading(){return Y()},get children(){return i(T,{get each(){return ce()},children:e=>i(r,{get id(){return e.id},get fingerprint(){return e.fingerprint}})})}})}}),i(u,{get loading(){return ne()},onClick:async()=>{if(!X())return void d.error(e("users.webauthn_not_supported"));const r=await re();g(r,async r=>{const n=q(r.options),t=r.session;try{const r=await B(n);g(await te(t,r),()=>{d.success(e("users.add_webauthn_success"))})}catch(s){s instanceof Error&&d.error(s.message)}})},get children(){return e("users.add_webauthn")}})]}}),i(h,{get when(){return f.can(w(),J.findIndex(e=>"ftp_read"===e))},get children(){return i(F,{isMine:!0,get userId(){return w().id}})}}),i(x,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return i(T,{each:J,children:(r,n)=>i(K,{get can(){return f.can(w(),n())},get children(){return e(`users.permissions.${r}`)}})})}})]}})})}}});
