System.register(["./index-legacy-BGZ4qXxI.js"],function(e,t){"use strict";var i,n,r,a,c,o,s,h,l,f,d,w,u,g,y;return{setters:[e=>{i=e.k,n=e.C,r=e.a9,a=e.at,c=e.O,o=e.aN,s=e.bu,h=e.b0,l=e.E,f=e.aa,d=e.S,w=e.a8,u=e.q,g=e.dp,y=e.ee}],execute:function(){var t=o("<div id=heic-container style=justify-content:center;align-items:center><canvas style=max-width:100%;max-height:100%;object-fit:contain>");e("default",()=>{const e=u();i();const[o,m]=n(!0),[p,v]=n(!1);let b,j,x,C=r.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===C.length&&(C=[r.obj]),a(()=>{_()}),c(()=>{b&&j&&(j=null),b=null});const _=async()=>{m(!0),v(!1);try{window.libheif||await k("/static/libheif/libheif.js","libheif-script");const e=await E("/static/libheif/libheif.wasm");b=window.libheif({wasmBinary:e}),j=new b.HeifDecoder,await I(r.raw_url)}catch(e){console.error("HEIC初始化失败:",e),v(!0),m(!1)}},k=(e,t)=>new Promise((i,n)=>{const r=document.createElement("script");r.src=e,r.id=t,r.onload=()=>i(),r.onerror=()=>n(`脚本加载失败: ${e}`),document.head.appendChild(r)}),E=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},I=async e=>{try{m(!0),v(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const i=await t.arrayBuffer(),n=j.decode(i);if(!n||0===n.length)throw"没有可解码的图像";const r=n[0];await B(r),m(!1)}catch(t){console.error("HEIC解码失败:",t),v(!0),m(!1)}},B=e=>new Promise(t=>{if(!x)return t();const i=e.get_width(),n=e.get_height();x.width=i,x.height=n;const r=new ImageData(i,n);e.display(r,e=>{if(!e||!x)return t();const i=x.getContext("2d");if(!i)return t();i.putImageData(e,0,0),t()})});return D=t(),H=D.firstChild,s(D,"position","relative"),s(D,"width","100%"),s(D,"height","75vh"),s(D,"display","flex"),s(D,"overflow","hidden"),"function"==typeof x?y(x,H):x=H,h(D,l(d,{get when(){return o()},get children(){return l(f,{})}}),null),h(D,l(d,{get when(){return p()},get children(){return l(w,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),g(e=>s(H,"display",o()||p()?"none":"block")),D;var D,H})}}});
