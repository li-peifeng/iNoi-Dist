System.register(["./index-legacy-ef60b5f6.js","./index-legacy-f4c8ce4d.js","./index-legacy-e121c32a.js","./webauthn-json.browser-ponyfill-legacy-2d91bd49.js","./PublicKeys-legacy-a3176ce7.js"],function(e,r){"use strict";var n,t,s,i,a,o,c,u,l,d,g,h,p,w,_,m,f,b,$,y,v,k,C,I,x,j,S,P,E,D,L,T,U,B,F,K,M,R,X,q,z;return{setters:[e=>{n=e.b,t=e.b5,s=e.bm,i=e.q,a=e.y,o=e.d1,c=e.aa,u=e.bS,l=e.D,d=e.bn,g=e.n,h=e.S,p=e.d,w=e.aC,_=e.d2,m=e.x,f=e.aB,b=e.af,$=e.d3,y=e.d4,v=e.d5,k=e.d6,C=e.aA,I=e.a9,x=e.d7,j=e.bM,S=e.bz,P=e.I,E=e.F,D=e.ae,L=e.ah,T=e.K,U=e.aP,B=e.aX,F=e.cj},e=>{K=e.e},e=>{M=e.L},e=>{R=e.s,X=e.c,q=e.b},e=>{z=e.P}],execute:function(){const r=e=>{const r=n(),[p,w]=t(()=>s.post("/authn/delete_authn",{id:e.id})),[_,m]=i(!1);return a(h,{get when(){return!_()},get children(){return a(o,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[a(c,{w:"$full",alignItems:"start",spacing:"$1",get children(){return a(u,{color:"$info9",css:{wordBreak:"break-all"},get children(){return"Fingerprint: "+e.fingerprint+"\tID: "+e.id}})}}),a(o,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return a(l,{colorScheme:"danger",get loading(){return p()},onClick:async()=>{const e=await w();d(e,()=>{g.success(r("global.delete_success")),m(!0)})},get children(){return r("global.delete")}})}})]}})}})},A=e=>a(B,{get colorScheme(){return e.can?"success":"danger"},get children(){return e.children}});e("default",()=>{const e=n();K("manage.sidemenu.profile");const{searchParams:o,to:B}=p(),[J,N]=i(w().username),[O,G]=i(""),[H,Q]=i(""),V=b("sso_compatibility_mode"),[W,Y]=t(e=>s.post("/me/update",{username:e?w().username:J(),password:e?"":O(),sso_id:w().sso_id})),[Z,ee]=t(()=>s.get("/authn/getcredentials")),[,re]=t(()=>s.get("/authn/webauthn_begin_registration")),[ne,te]=t((e,r)=>s.post("/authn/webauthn_finish_registration",JSON.stringify(r),{headers:{session:e}})),se=async r=>{if(O()&&O()!==H())return void g.warning(e("users.confirm_password_not_same"));const n=await Y(r);d(n,()=>{_({...w(),username:J()}),r?B(""):(g.success(e("users.update_profile_success")),B(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})},ie=o.sso_id;function ae(e){const r=e.data;r.sso_id&&(_({...w(),sso_id:r.sso_id}),se(!0))}ie&&(_({...w(),sso_id:ie}),se(!0)),window.addEventListener("message",ae),m(()=>{window.removeEventListener("message",ae)});const[oe,ce]=i([]);return R()&&!f.is_guest(w())&&b("webauthn_login_enabled")&&(async()=>{const e=await ee();F(e,ce)})(),a(c,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[a(h,{get when(){return!f.is_guest(w())},get fallback(){return[a($,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[a(y,{mr:"$2_5"}),a(v,{mr:"$2_5",get children(){return e("users.guest-tips")}}),a(k,{get children(){return e("users.modify_nothing")}})]}}),a(C,{spacing:"$2",get children(){return[a(I,{get children(){return e("global.have_account")}}),a(I,{color:"$info9",as:M,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return e("global.go_login")}})]}})]},get children(){return[a(u,{get children(){return e("users.update_profile")}}),a(x,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return a(j,{get children(){return[a(S,{for:"username",get children(){return e("users.change_username")}}),a(P,{id:"username",get value(){return J()},onInput:e=>{N(e.currentTarget.value)}})]}})}}),a(x,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[a(j,{get children(){return[a(S,{for:"password",get children(){return e("users.change_password")}}),a(P,{id:"password",type:"password",placeholder:"********",get value(){return O()},onInput:e=>{G(e.currentTarget.value)}}),a(E,{get children(){return e("users.change_password-tips")}})]}}),a(j,{get children(){return[a(S,{for:"confirm-password",get children(){return e("users.confirm_password")}}),a(P,{id:"confirm-password",type:"password",placeholder:"********",get value(){return H()},onInput:e=>{Q(e.currentTarget.value)}}),a(E,{get children(){return e("users.confirm_password-tips")}})]}})]}}),a(C,{spacing:"$2",get children(){return[a(l,{get loading(){return W()},onClick:[se,!1],get children(){return e("global.save")}}),a(h,{get when(){return!w().otp},get children(){return a(l,{colorScheme:"accent",onClick:()=>{B("/@manage/2fa")},get children(){return e("users.enable_2fa")}})}})]}})]}}),a(h,{get when(){return D(()=>!!b("sso_login_enabled"))()&&!f.is_guest(w())},get children(){return[a(u,{get children(){return e("users.sso_login")}}),a(C,{spacing:"$2",get children(){return a(h,{get when(){return w().sso_id},get fallback(){return a(l,{onClick:()=>{const e=s.getUri()+"/auth/sso?method=get_sso_id";V?window.location.href=e:window.open(e,"authPopup","width=500,height=600")},get children(){return e("users.connect_sso")}})},get children(){return a(l,{colorScheme:"danger",get loading(){return W()},onClick:()=>{_({...w(),sso_id:""}),se(!0)},get children(){return e("users.disconnect_sso")}})}})}})]}}),a(h,{get when(){return D(()=>!f.is_guest(w()))()&&b("webauthn_login_enabled")},get children(){return[a(u,{get children(){return e("users.webauthn")}}),a(C,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return a(L,{get loading(){return Z()},get children(){return a(T,{get each(){return oe()},children:e=>a(r,{get id(){return e.id},get fingerprint(){return e.fingerprint}})})}})}}),a(l,{get loading(){return ne()},onClick:async()=>{if(!R())return void g.error(e("users.webauthn_not_supported"));const r=await re();d(r,async r=>{const n=X(r.options),t=r.session;try{const r=await q(n);d(await te(t,r),()=>{g.success(e("users.add_webauthn_success"))})}catch(s){s instanceof Error&&g.error(s.message)}})},get children(){return e("users.add_webauthn")}})]}}),a(z,{isMine:!0,get userId(){return w().id}}),a(C,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return a(T,{each:U,children:(r,n)=>a(A,{get can(){return f.can(w(),n())},get children(){return e(`users.permissions.${r}`)}})})}})]}})})}}});
