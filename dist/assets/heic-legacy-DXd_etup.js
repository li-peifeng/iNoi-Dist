System.register(["./index-legacy-DG73-P5H.js"],function(e,t){"use strict";var r,i,n,s,a,o,l,c,h,y,d,f,u,w;return{setters:[e=>{r=e.k,i=e.C,n=e.R,s=e.au,a=e.O,o=e.aN,l=e.a$,c=e.E,h=e.ae,y=e.S,d=e.ad,f=e.q,u=e.di,w=e.e8}],execute:function(){var t=o("<div id=heic-container><canvas>");e("default",()=>{const e=f();r();const[o,p]=i(!0),[g,m]=i(!1);let v,P,b,j=n.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===j.length&&(j=[n.obj]),s(()=>{x()}),a(()=>{v&&P&&(P=null),v=null});const x=async()=>{p(!0),m(!1);try{window.libheif||await C("/static/libheif/libheif.js","libheif-script");const e=await _("/static/libheif/libheif.wasm");v=window.libheif({wasmBinary:e}),P=new v.HeifDecoder,await k(n.raw_url)}catch(e){console.error("HEIC初始化失败:",e),m(!0),p(!1)}},C=(e,t)=>new Promise((r,i)=>{const n=document.createElement("script");n.src=e,n.id=t,n.onload=()=>r(),n.onerror=()=>i(`脚本加载失败: ${e}`),document.head.appendChild(n)}),_=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},k=async e=>{try{p(!0),m(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const r=await t.arrayBuffer(),i=P.decode(r);if(!i||0===i.length)throw"没有可解码的图像";const n=i[0];await E(n),p(!1)}catch(t){console.error("HEIC解码失败:",t),m(!0),p(!1)}},E=e=>new Promise(t=>{if(!b)return t();const r=e.get_width(),i=e.get_height();b.width=r,b.height=i;const n=new ImageData(r,i);e.display(n,e=>{if(!e||!b)return t();const r=b.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()})});return I=t(),$=I.firstChild,I.style.setProperty("position","relative"),I.style.setProperty("width","100%"),I.style.setProperty("height","75vh"),I.style.setProperty("display","flex"),I.style.setProperty("justify-content","center"),I.style.setProperty("align-items","center"),I.style.setProperty("overflow","hidden"),"function"==typeof b?w(b,$):b=$,$.style.setProperty("max-width","100%"),$.style.setProperty("max-height","100%"),$.style.setProperty("object-fit","contain"),l(I,c(y,{get when(){return o()},get children(){return c(h,{})}}),null),l(I,c(y,{get when(){return g()},get children(){return c(d,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),u(e=>null!=(e=o()||g()?"none":"block")?$.style.setProperty("display",e):$.style.removeProperty("display")),I;var I,$})}}});
