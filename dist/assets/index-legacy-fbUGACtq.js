System.register(["./index-legacy-yN-z1lAK.js","./index-legacy-DRrLOnvb.js","./webauthn-json.browser-ponyfill-legacy-8XJfKV2b.js"],function(e,t){"use strict";var n,r,o,a,s,l,i,c,u,g,d,h,p,m,w,b,f,$,y,_,v,k,I,C,S,x,E,j,P,z,K,U,L,R,A,D,G,M,O,T,q,J,F,N;return{setters:[e=>{n=e.cq,r=e.k,o=e.cl,a=e.cr,s=e.O,l=e.E,i=e.aX,c=e.ar,u=e.bv,g=e.cs,d=e.ct,h=e.cu,p=e.W,m=e.a3,w=e.P,b=e.C,f=e.cv,$=e.bd,y=e.av,_=e.ai,v=e.c3,k=e.aK,I=e.c4,C=e.S,S=e.I,x=e.q,E=e.bg,j=e.ah,P=e.$,z=e.aJ,K=e.L,U=e.bG,L=e.aO,R=e.cw,A=e.x,D=e.by},e=>{G=e.F,M=e.g,O=e.a,T=e.S,q=e.h},e=>{J=e.s,F=e.g,N=e.a}],execute:function(){const t=()=>{const e=c("sso_login_enabled"),t=p("sso_login_platform"),n=c("sso_compatibility_mode"),{searchParams:m,to:w}=r(),b=m.token;function f(e){const t=e.data;t.token&&(o(t.token),w(decodeURIComponent(m.redirect||a||"/"),!0))}if(null!=b&&""!=b&&(o(b),w(decodeURIComponent(m.redirect||a||"/"),!0)),window.addEventListener("message",f),s(()=>{window.removeEventListener("message",f)}),e){const e=()=>{const e=u.getUri()+"/auth/sso?method=sso_get_token";n?window.location.href=e:window.open(e,"authPopup","width=500,height=600")};let r;switch(t){case"Github":r=M;break;case"Microsoft":r=h;break;case"Google":r=d;break;case"Dingtalk":r=g;break;default:r=G}return l(i,{cursor:"pointer",boxSize:"$8",as:r,p:"$0_5",onclick:e})}};e("default",()=>{const e=p("logo").split("\n"),g=m(e[0],e.pop()),d=x(),h=w(()=>`${p("site_title")}`);O(h);const G=m("white","$neutral1"),[M,W]=b(localStorage.getItem("username")||""),[X,B]=b(localStorage.getItem("password")||""),[H,Q]=b(""),[V,Y]=b(!1),[Z,ee]=f("remember-pwd","false"),[te,ne]=b(!1),[re,oe]=$(async()=>{return te()?u.post("/auth/login/ldap",{username:M(),password:X(),otp_code:H()}):u.post("/auth/login/hash",{username:M(),password:(e=X(),n(`${e}-https://github.com/alist-org/alist`)),otp_code:H()});var e}),[,ae]=$((e,t,n,r)=>u.post("/authn/webauthn_finish_login?username="+n,JSON.stringify(t),{headers:{session:e},signal:r})),[,se]=$((e,t)=>u.get("/authn/webauthn_begin_login?username="+e,{signal:t})),{searchParams:le,to:ie}=r(),ce=c("webauthn_login_enabled"),ue=async()=>{Y(!V())};let ge=null;const de=async e=>{if(!J())return void(e||A.error(d("users.webauthn_not_supported")));if(e&&!(await(async()=>!(!PublicKeyCredential||!("isConditionalMediationAvailable"in PublicKeyCredential))&&await PublicKeyCredential.isConditionalMediationAvailable())()))return;ge?.abort();const t=new AbortController;ge=t;const n=e?"":M();e||"true"!==Z()?localStorage.removeItem("username"):localStorage.setItem("username",M());const r=await se(n,t.signal);D(r,async r=>{try{const s=F(r.options);s.signal=t.signal,e&&(s.mediation="conditional");const l=await N(s),i=await ae(r.session,l,n,t.signal);R(i,e=>{A.success(d("login.success")),o(e.token),ie(decodeURIComponent(le.redirect||a||"/"),!0)})}catch(s){s instanceof Error&&"AbortError"!=s.name&&A.error(s.message)}})},he=()=>ge?.abort();y(()=>{ce&&(window.addEventListener("beforeunload",he),de(!0))}),s(()=>{ge?.abort(),window.removeEventListener("beforeunload",he)});const pe=async()=>{if(V())await de();else{"true"===Z()?(localStorage.setItem("username",M()),localStorage.setItem("password",X())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const e=await oe();R(e,e=>{A.success(d("login.success")),o(e.token),ie(decodeURIComponent(le.redirect||a||"/"),!0)},(e,t)=>{me()||402!==t?A.error(e):we(!0)})}},[me,we]=b(!1),be=c("ldap_login_enabled"),fe=p("ldap_login_tips");return be&&ne(!0),l(L,{zIndex:"1",w:"$full",h:"100vh",get children(){return l(_,{get bgColor(){return G()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[l(v,{alignItems:"center",justifyContent:"space-around",get children(){return[l(k,{mr:"$2",boxSize:"$12",get src(){return g()}}),l(I,{color:"$info9",fontSize:"$2xl",get children(){return h()}})]}}),l(C,{get when(){return!me()},get fallback(){return l(S,{id:"totp",name:"otp",get placeholder(){return d("login.otp-tips")},get value(){return H()},onInput:e=>Q(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&pe()}})},get children(){return[l(S,{name:"username",get placeholder(){return d("login.username-tips")},get value(){return M()},onInput:e=>W(e.currentTarget.value)}),l(C,{get when(){return!V()},get children(){return l(S,{name:"password",get placeholder(){return d("login.password-tips")},type:"password",get value(){return X()},onInput:e=>B(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&pe()}})}}),l(v,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[l(E,{get checked(){return"true"===Z()},onChange:()=>ee("true"===Z()?"false":"true"),get children(){return d("login.remember")}}),l(j,{color:"$success9",as:P,href:"https://peifeng.li/cloud-help",get children(){return d("login.help")}})]}})]}}),l(z,{w:"$full",spacing:"$2",get children(){return[l(C,{get when(){return!V()},get children(){return[l(K,{w:"$full",colorScheme:"danger",onClick:()=>{o(),ie(decodeURIComponent(le.redirect||a||"/"),!0)},get children(){return d("login.use_guest")}}),l(K,{colorScheme:"warning",w:"$full",onClick:()=>{me()?Q(""):(W(""),B(""))},get children(){return d("login.clear")}})]}}),l(K,{colorScheme:"success",w:"$full",get loading(){return re()},onClick:pe,get children(){return d("login.login")}})]}}),l(C,{when:be,get children(){return l(E,{w:"$full",get checked(){return!0===te()},onChange:()=>ne(!te()),children:fe})}}),l(v,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[l(T,{}),l(t,{}),l(C,{when:ce,get children(){return l(i,{cursor:"pointer",boxSize:"$8",as:q,p:"$0_5",onclick:ue})}}),l(U,{})]}})]}})}})})}}});
