System.register(["./index-legacy-BBYhKAGR.js"],function(e,t){"use strict";var r,n,i,o,a,s,l,c,h,y,d,w,f,u;return{setters:[e=>{r=e.k,n=e.C,i=e.R,o=e.au,a=e.O,s=e.aN,l=e.a$,c=e.E,h=e.ae,y=e.S,d=e.ad,w=e.q,f=e.di,u=e.e8}],execute:function(){var t=s("<div id=heic-container><canvas>");e("default",()=>{const e=w(),{replace:s}=r(),[p,g]=n(!0),[m,v]=n(!1);let P=i.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===P.length&&(P=[i.obj]);const b=e=>{const t=P.findIndex(e=>e.name===i.obj.name);"ArrowLeft"===e.key&&t>0?s(P[t-1].name):"ArrowRight"===e.key&&t<P.length-1&&s(P[t+1].name)};let j,k,x;o(()=>{window.addEventListener("keydown",b),C()}),a(()=>{window.removeEventListener("keydown",b),j&&k&&(k.free(),k=null),j=null});const C=async()=>{g(!0),v(!1);try{window.libheif||await E("/static/libheif/libheif.js","libheif-script");const e=await I("/static/libheif/libheif.wasm");j=window.libheif({wasmBinary:e}),k=new j.HeifDecoder,await _(i.raw_url)}catch(e){console.error("HEIC初始化失败:",e),v(!0),g(!1)}},E=(e,t)=>new Promise((r,n)=>{const i=document.createElement("script");i.src=e,i.id=t,i.onload=()=>r(),i.onerror=()=>n(`脚本加载失败: ${e}`),document.head.appendChild(i)}),I=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},_=async e=>{try{g(!0),v(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const r=await t.arrayBuffer(),n=k.decode(r);if(!n||0===n.length)throw"没有可解码的图像";const i=n[0];await $(i),g(!1)}catch(t){console.error("HEIC解码失败:",t),v(!0),g(!1)}},$=e=>new Promise(t=>{if(!x)return t();const r=e.get_width(),n=e.get_height();x.width=r,x.height=n;const i=new ImageData(r,n);e.display(i,e=>{if(!e||!x)return t();const r=x.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()})});return A=t(),B=A.firstChild,A.style.setProperty("position","relative"),A.style.setProperty("width","100%"),A.style.setProperty("height","75vh"),A.style.setProperty("display","flex"),A.style.setProperty("justify-content","center"),A.style.setProperty("align-items","center"),A.style.setProperty("overflow","hidden"),"function"==typeof x?u(x,B):x=B,B.style.setProperty("max-width","100%"),B.style.setProperty("max-height","100%"),B.style.setProperty("object-fit","contain"),l(A,c(y,{get when(){return p()},get children(){return c(h,{})}}),null),l(A,c(y,{get when(){return m()},get children(){return c(d,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),f(e=>null!=(e=p()||m()?"none":"block")?B.style.setProperty("display",e):B.style.removeProperty("display")),A;var A,B})}}});
