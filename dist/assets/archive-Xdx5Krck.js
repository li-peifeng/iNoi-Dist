import{k as N,bd as X,er as ce,es as de,P as ue,C as u,D as ge,E as e,a2 as he,X as H,Y as V,U as Y,a1 as me,a6 as fe,a7 as P,a8 as we,S as J,ae as f,q as Q,an as be,ag as K,V as pe,af as xe,d3 as $e,bX as w,aH as E,aX as Z,aB as ke,r as _e,cB as ve,ds as ye,a0 as Ce,au as je,et as Me,bY as Se,cx as Pe,aM as Le,aZ as Oe,aK as Be,aL as Ie,_ as L,aT as Ee}from"./index-KgNcVsnB.js";import{L as ze,c as b}from"./List-CRa7KYGZ.js";import{b as Ae,e as qe}from"./index-C_wIkh2E.js";import Te from"./Password-B79Wznq9.js";import{u as Fe}from"./helper-Bv0oiSbX.js";import{g as Ue}from"./icon-l99xtk-E.js";import{b as De,x as O,w as Re}from"./style-TC7mKgr1.js";import"./obj-H61i4oAB.js";import"./Layout-YuyoaeGv.js";import"./index-tIPZKPfd.js";import"./FolderTree-D7Iz4H4q.js";import"./index-BmP4pfzk.js";import"./index-BTmntxeJ.js";import"./share-BYkyraE_.js";import"./icons-CLQ0D511.js";import"./index-DoQqFhDb.js";function We(){let n=!1,i=[];return{acquire:()=>new Promise(c=>{n?i.push(c):(n=!0,c())}),release:()=>{i.length>0?i.shift()():n=!1}}}const G=n=>{window.open(n,"_blank")},Xe=n=>{const{show:i}=De({id:2}),{isMouseSupported:c}=Fe(),s=()=>_e.list_item_filename_overflow;return e(je.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(E,{class:"list-item viselect-item",get"data-index"(){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:Ce()}},get cursor(){return c()?"default":"pointer"},"on:click":h=>{n.obj.is_dir?n.jumpCallback():n.url&&G(n.url)},onContextMenu:h=>{i(h,{props:n})},get children(){return[e(E,{class:"name-box",spacing:"$1",get w(){return b[0].w},get children(){return[e(Z,{class:"icon",boxSize:"$6",get color(){return ke()},get as(){return Ue(n.obj)},mr:"$1"}),e(f,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:s()==="multi_line"?"unset":"nowrap","overflow-x":s()==="scrollable"?"auto":"hidden",textOverflow:s()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(f,{class:"size",get w(){return b[1].w},get textAlign(){return b[1].textAlign},get children(){return ve(n.obj.size)}}),e(f,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return b[2].w},get textAlign(){return b[2].textAlign},get children(){return ye(n.obj.modified)}})]}})}})},B={extract:{icon:qe,color:"$success9"},copy_link:{icon:Ae,color:"$info9"},download:{icon:Ee,color:"$primary9"}},He=()=>{const{copy:n}=Se(),{colorMode:i}=Pe(),{isShare:c}=N();return e(Re,{id:2,animation:"scale",get theme(){return i()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(O,{hidden:({props:s})=>s.obj.is_dir,onClick:({props:s})=>{G(s.url)},get children(){return e(I,{name:"download"})}}),e(O,{hidden:({props:s})=>s.obj.is_dir,onClick:({props:s})=>{n(s.url)},get children(){return e(I,{name:"copy_link"})}}),e(O,{hidden:()=>{const s=Oe.findIndex(h=>h==="decompress");return!c()&&!Be.can(Ie(),s)},onClick:({props:s})=>{Le.emit("extract",JSON.stringify({inner:s.innerPath,pass:s.pass}))},get children(){return e(I,{name:"extract"})}})]}})},I=n=>{const i=Q();return e(E,{spacing:"$2",get children(){return[e(Z,{get p(){return B[n.name].p?"$1":void 0},get as(){return B[n.name].icon},boxSize:"$7",get color(){return B[n.name].color}}),e(f,{get children(){return i("home.toolbar.".concat(n.name))}})]}})},lt=()=>{const n=Q(),{pathname:i}=N(),[c,s]=X(ce),[h,z]=X(de),ee=ue(()=>c()||h());let l="",p="",_="",x=null;const[v,$]=u(""),[te,A]=u(!1),[y,C]=u(!1),[q,re]=u(""),[d,j]=u([]),[M,T]=u(),[ne,F]=u(!1),[ae,U]=u(""),g=We(),k=r=>{let a={};return r.forEach(t=>{a[t.name]={...t,children:t.children?k(t.children):null}}),a},S=r=>r.code===200?!1:(r.code===202?w(()=>{l!==""&&A(!0),C(!0),$("")}):$(r.message),!0),D=async r=>{if(await g.acquire(),y()&&l==="")return g.release(),[];if(p===""){const t=await s(i(),L(),l);if(S(t))return g.release(),[];if(t.data.content!==null&&(x=k(t.data.content)),p=t.data.raw_url,_=t.data.sign,re(t.data.comment),t.data.sort!==void 0){let o;t.data.sort.order_by!==""&&(o=t.data.sort.order_by);let m=t.data.sort.order_direction==="desc",le=t.data.sort.extract_folder;w(()=>{T(o),F(m),U(le)})}if(t.data.encrypted&&l==="")return w(()=>{C(!0),$("")}),g.release(),[]}if(x===null){const t=await z(i(),L(),l,"/");if(S(t))return g.release(),[];x=k(t.data.content)}let a=x;for(let t=0;t<r.length;t++){if(a[r[t]].children===null){const o=await z(i(),L(),l,"/"+r.slice(0,t+1).join("/"));if(S(o))return g.release(),[];a[r[t]].children=k(o.data.content)}a=a[r[t]].children}return w(()=>{C(!1),A(!1),$("")}),g.release(),Object.values(a)},[se,R]=u([]);ge(()=>{D(d()).then(r=>R(r))});const W=()=>{D(d()).then(r=>R(r))};W();const oe=()=>{let r=se();M()&&(r=r.sort((t,o)=>(ne()?-1:1)*Me(t[M()],o[M()])));let a=ae();if(a!==""){let t=[],o=[];r.forEach(m=>(m.is_dir?t:o).push(m)),r=a==="front"?t.concat(o):o.concat(t)}return r},ie=(r,a)=>{w(()=>{U(""),T(r),a!==void 0&&F(a)})};return e(K,{spacing:"$2",w:"$full",get children(){return[e(he,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(H,{get children(){return e(V,{get currentPage(){return d().length===0},"on:click":()=>j([]),children:"."})}}),e(Y,{get each(){return d()},children:(r,a)=>e(H,{get children(){return[e(me,{}),e(V,{get currentPage(){return d().length===a()+1},"on:click":()=>j(d().slice(0,a()+1)),children:r})]}})})]}}),e(fe,{get children(){return[e(P,{get when(){return v()!==""},get children(){return e(we,{get msg(){return v()},disableColor:!0})}}),e(P,{get when(){return y()},get children(){return e(Te,{get title(){return n("home.toolbar.archive.input_password")},password:()=>l,setPassword:r=>l=r,enterCallback:()=>W(),get children(){return e(J,{get when(){return te()},get children(){return e(f,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(P,{get when(){return xe(()=>!y())()&&v()===""},get children(){return e(be,{get loading(){return ee()},get children(){return e(K,{class:"list",w:"$full",spacing:"$1",get children(){return[e(ze,{sortCallback:ie,disableCheckbox:!0}),e(Y,{get each(){return oe()},children:(r,a)=>{let t,o=(d().length>0?"/"+d().join("/"):"")+"/"+r.name;if(!r.is_dir){const m=p.includes("?");t=p+"".concat(m?"&":"?","inner=").concat(pe(o,!0)),l!==""&&(t=t+"&pass=".concat(encodeURIComponent(l))),_!==""&&(t=t+"&sign=".concat(_))}return e(Xe,{obj:r,get index(){return a()},jumpCallback:()=>j(d().concat(r.name)),innerPath:o,url:t,pass:l})}}),e(He,{})]}})}})}})]}}),e(J,{get when(){return q()!==""},get children(){return[e($e,{}),e(f,{w:"$full",pl:"$1",pr:"$1",get children(){return q()}})]}})]}})};export{lt as default};
