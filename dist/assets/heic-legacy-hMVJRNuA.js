System.register(["./index-legacy-CBHUkAr_.js"],function(e,t){"use strict";var i,n,a,r,o,c,s,h,l,f,d,w,u,g,y,m;return{setters:[e=>{i=e.k,n=e.C,a=e.e1,r=e.a9,o=e.at,c=e.O,s=e.aN,h=e.bt,l=e.a$,f=e.E,d=e.aa,w=e.S,u=e.a8,g=e.q,y=e.dj,m=e.ea}],execute:function(){var t=s("<div id=heic-container style=justify-content:center;align-items:center><canvas style=max-width:100%;max-height:100%;object-fit:contain>");e("default",()=>{const e=g();i();const[s,v]=n(!0),[p,b]=n(!1),{libHeifPath:j}=a();let x,C,$,_=r.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===_.length&&(_=[r.obj]),o(()=>{k()}),c(()=>{x&&C&&(C=null),x=null});const k=async()=>{v(!0),b(!1);try{window.libheif||await E(`${j()}/libheif.js`,"libheif-script");const e=await H(`${j()}/libheif.wasm`);x=window.libheif({wasmBinary:e}),C=new x.HeifDecoder,await I(r.raw_url)}catch(e){console.error("HEIC初始化失败:",e),b(!0),v(!1)}},E=(e,t)=>new Promise((i,n)=>{const a=document.createElement("script");a.src=e,a.id=t,a.onload=()=>i(),a.onerror=()=>n(`脚本加载失败: ${e}`),document.head.appendChild(a)}),H=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},I=async e=>{try{v(!0),b(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const i=await t.arrayBuffer(),n=C.decode(i);if(!n||0===n.length)throw"没有可解码的图像";const a=n[0];await B(a),v(!1)}catch(t){console.error("HEIC解码失败:",t),b(!0),v(!1)}},B=e=>new Promise(t=>{if(!$)return t();const i=e.get_width(),n=e.get_height();$.width=i,$.height=n;const a=new ImageData(i,n);e.display(a,e=>{if(!e||!$)return t();const i=$.getContext("2d");if(!i)return t();i.putImageData(e,0,0),t()})});return D=t(),P=D.firstChild,h(D,"position","relative"),h(D,"width","100%"),h(D,"height","75vh"),h(D,"display","flex"),h(D,"overflow","hidden"),"function"==typeof $?m($,P):$=P,l(D,f(w,{get when(){return s()},get children(){return f(d,{})}}),null),l(D,f(w,{get when(){return p()},get children(){return f(u,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),y(e=>h(P,"display",s()||p()?"none":"block")),D;var D,P})}}});
