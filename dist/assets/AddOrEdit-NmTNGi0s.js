import{k,cs as C,bc as p,bt as d,E as e,ah as v,b_ as F,q as f,S as h,bT as i,bG as l,I as m,aK as c,bZ as L,W as S,aY as q,L as T,bw as g,x as D,aL as E,d5 as M,bf as b,ao as P}from"./index-B8BdErJo.js";import{a as U}from"./FolderTree-D-x5a9kB.js";import{P as K}from"./PublicKeys-TPGd_r2h.js";import"./index-CAxXFbHH.js";const R=r=>{const u=f();return e(i,{display:"inline-flex",flexDirection:"row",alignItems:"center",gap:"$2",rounded:"$md",shadow:"$md",p:"$2",w:"fit-content",get children(){return[e(l,{mb:"0",get children(){return u("users.permissions.".concat(r.name))}}),e(b,{get checked(){return r.can},onChange:()=>r.onChange(!r.can)})]}})},O=()=>{const r=f(),{params:u,back:w}=k(),{id:n}=u,[t,a]=C({id:0,username:"",password:"",base_path:"",role:0,permission:0,disabled:!1,sso_id:""}),[$,x]=p(()=>d.get("/admin/user/get?id=".concat(n)));n&&(async()=>{const s=await x();g(s,a)})();const[y,I]=p(()=>d.post("/admin/user/".concat(n?"update":"create"),t));return e(P,{get loading(){return $()},get children(){return e(v,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[e(F,{get children(){return r("global.".concat(n?"edit":"add"))}}),e(h,{get when(){return!c.is_guest(t)},get children(){return[e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"username",display:"flex",alignItems:"center",get children(){return r("users.username")}}),e(m,{id:"username",get value(){return t.username},onInput:s=>a("username",s.currentTarget.value)})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"password",display:"flex",alignItems:"center",get children(){return r("users.password")}}),e(m,{id:"password",type:"password",placeholder:"********",get value(){return t.password},onInput:s=>a("password",s.currentTarget.value)})]}})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"base_path",display:"flex",alignItems:"center",get children(){return r("users.base_path")}}),e(U,{id:"base_path",get value(){return t.base_path},onChange:s=>a("base_path",s),onlyFolder:!0})]}}),e(i,{w:"$full",required:!0,get children(){return[e(l,{display:"flex",alignItems:"center",get children(){return r("users.permission")}}),e(L,{w:"$full",wrap:"wrap",gap:"$2",get children(){return e(S,{each:q,children:(s,o)=>e(R,{name:s,get can(){return c.can(t,o())},onChange:_=>{_?a("permission",t.permission|=1<<o()):a("permission",t.permission&=~(1<<o()))}})})}})]}}),e(h,{get when(){return n&&!c.is_guest(t)},get children(){return e(K,{isMine:!1,get userId(){return parseInt(n)}})}}),e(T,{get loading(){return y()},onClick:async()=>{const s=await I();g(s,async()=>{D.success(r("global.save_success")),t.username===E().username&&g(await d.get("/me"),M),w()})},get children(){return r("global.".concat(n?"save":"add"))}}),e(i,{w:"fit-content",display:"flex",get children(){return e(b,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:s=>a("disabled",s.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return t.disabled},get children(){return r("users.disabled")}})}})]}})}})};export{O as default};
