System.register(["./index-legacy-DxcHdJs-.js","./obj-legacy-BKgCPAKc.js","./video_box-legacy-DNcL6nVa.js","./hls-legacy-BdX1Wcg8.js","./icons-legacy-CxsxHJbW.js","./index-legacy-B7b17WXA.js"],function(e,t){"use strict";var i,n,s,l,o,a,r,c,u,d,h,p,m,f,g,y,w,b,v,_,k,x,O,S,j,C,z,F,L,I,q,A,N,T,E,P;return{setters:[e=>{i=e.k,n=e.ak,s=e.e7,l=e.a9,o=e.e8,a=e.aB,r=e.cR,c=e.aN,u=e.bu,d=e.b0,h=e.d4,p=e.d6,m=e.bd,f=e.bv,g=e._,y=e.at,w=e.O,b=e.C,v=e.E,_=e.am,k=e.S,x=e.aO,O=e.ap,S=e.by,j=e.x,C=e.A,z=e.e9},e=>{F=e.O},e=>{L=e.A,I=e.V,q=e.e},e=>{A=e.a,N=e.e,T=e.H},e=>{E=e.A},e=>{P=e.q}],execute:function(){var t=c("<span style=max-width:200px;text-overflow:ellipsis;word-break:break-all;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:12px>");e("default",()=>{const{pathname:e,searchParams:c}=i(),{proxyLink:R}=n(),V=s();let W=l.objs.filter(e=>e.type===F.VIDEO);0===W.length&&(W=[l.obj]);let B,D={id:e(),container:"#video-player",title:l.obj.name,volume:.5,autoplay:O("video_autoplay"),autoSize:!1,autoMini:!0,controls:[],loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!1,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,theme:a(),quality:[],plugins:[L],whitelist:[],screenshot:!0,settings:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0,crossOrigin:"anonymous"},type:"m3u8",customType:{m3u8:function(e,t){const i=new T;i.loadSource(t),i.attachMedia(e),e.src||(e.src=t)}},lang:["en","zh-cn","zh-tw"].includes(o().toLowerCase())?o().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const H=l.related.filter(e=>{for(const t of[".srt",".ass",".vtt"])if(e.name.endsWith(t))return!0;return!1}),M=l.related.find(e=>{for(const t of[".xml"])if(e.name.endsWith(t))return!0;return!1});if(0!=H.length){let e=function(e){"ass"==(i?"ass":"webvtt")?(B.subtitle.show=!1,B.emit("artplayer-plugin-ass:visible",e)):(B.subtitle.show=e,B.emit("artplayer-plugin-ass:visible",!1))},i=!1;const n=H[0];"ass"===r(n.name).toLowerCase()?(i=!0,D.plugins?.push(A({subUrl:R(n,!0)}))):D.subtitle={url:R(n,!0),type:r(n.name)};const s=[{id:"setting_subtitle_display",html:"Display",tooltip:"Show",switch:!0,onSwitch:function(t){t.tooltip=t.switch?"Hide":"Show",e(!t.switch);const i=D.settings?.find(e=>"setting_subtitle"===e.id);return i&&(i.tooltip=t.tooltip),!t.switch}}];H.forEach((e,i)=>{var n;s.push({default:0===i,html:(n=t(),u(n,"overflow","hidden"),u(n,"display","-webkit-box"),d(n,()=>e.name),h(()=>p(n,"title",e.name)),n),name:e.name,url:R(e,!0)})}),D.settings?.push({id:"setting_subtitle",html:"Subtitle",tooltip:"Show",icon:E({size:24}),selector:s,onSelect:function(t){"ass"===r(t.name).toLowerCase()?(i=!0,this.emit("artplayer-plugin-ass:switch",t.url),e(!0)):(i=!1,this.subtitle.switch(t.url,{name:t.name}),this.once("subtitleLoad",e.bind(this,!0)));const n=s.find(e=>"setting_subtitle_display"===e.id);return n&&!n.switch&&n.$html?.click?.(),n?.tooltip}})}M&&D.plugins?.push(N({danmuku:R(M,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,synchronousPlayback:!1,lockTime:5,maxLength:100,theme:"dark"}));const[U,$]=m(()=>f.post("/fs/other",{path:e(),password:g(),method:"video_preview"}));let G,J;async function K(){const e=await $();S(e,async e=>{const t=e.video_preview_play_info.live_transcoding_task_list.filter(e=>e.url);if(0===t.length)return void j.error("No transcoding video found");const i=t.map((e,i)=>({html:e.template_id,url:e.url,default:i===t.length-1}));D.quality=i,B.quality=i,J=B.currentTime;let n=B.playing;await B.switchUrl(i[i.length-1].url),n||B.pause(),setTimeout(()=>{B.seek=J},1e3)})}y(async()=>{const e=await $();Z(200!==e.code),S(e,e=>{const t=e.video_preview_play_info.live_transcoding_task_list.filter(e=>e.url);if(0===t.length)return void j.error("No transcoding video found");let i;switch(D.url=t[t.length-1].url,D.quality=t.map((e,i)=>({html:e.template_id,url:e.url,default:i===t.length-1})),B=new q(D),c.auto_fullscreen){case"true":i=!0;case"false":i=!1;default:i=!1}B.on("ready",()=>{B.fullscreen=i}),B.on("video:ended",()=>{Q()&&(()=>{const e=W.findIndex(e=>e.name===l.obj.name);e<W.length-1&&V(C(z(location.pathname),W[e+1].name)+"?auto_fullscreen="+B.fullscreen)})()}),G=window.setInterval(K,84e4)}),B.on("error",()=>{B.video.crossOrigin&&(console.log("Error detected. Trying to remove Cross-Origin attribute. Screenshot may not be available."),B.video.crossOrigin=null)})}),w(()=>{B?.destroy(),window.clearInterval(G)});const[Q,X]=b(),[Y,Z]=b(!1);return v(I,{onAutoNextChange:X,get children(){return[v(_,{w:"$full",h:"60vh",id:"video-player"}),v(k,{get when(){return Y()},get children(){return v(x,{w:"100%",h:"60vh",bgColor:"black",get children(){return v(P,{size:"4rem"})}})}})]}})})}}});
